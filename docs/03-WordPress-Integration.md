# WordPress Integration

When WP Starter finishes its job it leaves the project folder ready to be used, but WP Starter code does **not** really interact with WordPress after its job is done.

However, the `wp-config.php` WP Starter generates it is a bit different than the standard one, and introduces a few things into WordPress that are specific to WP Starter-powered websites.



## Environment

In the environment variables documentation has been explained how WP Starter sets WordPress constants from env variables. That is done via some code placed in the  `wp-config.php` generated by WP Starter.

Besides the env vars named after WordPress constants there are a few that have a special meaning for WP Starter powered WordPress installation.

### WP_ENV

If **`WP_ENV`** variable is set to either `"development"`, `"staging"` or `"production"` WP Starter will setup debug constants accordingly.

The code that does it looks like this:

```php
switch (getenv('WP_ENV')) {
    case 'development':
        defined('WP_DEBUG') or define('WP_DEBUG', true);
        defined('WP_DEBUG_DISPLAY') or define('WP_DEBUG_DISPLAY', true);
        defined('WP_DEBUG_LOG') or define('WP_DEBUG_LOG', false);
        defined('SAVEQUERIES') or define('SAVEQUERIES', true);
        defined('SCRIPT_DEBUG') or define('SCRIPT_DEBUG', true);
        break;
    case 'staging':
        defined('WP_DEBUG') or define('WP_DEBUG', true);
        defined('WP_DEBUG_DISPLAY') or define('WP_DEBUG_DISPLAY', false);
        defined('WP_DEBUG_LOG') or define('WP_DEBUG_LOG', true);
        defined('SAVEQUERIES') or define('SAVEQUERIES', false);
        defined('SCRIPT_DEBUG') or define('SCRIPT_DEBUG', true);
        break;
    case 'production':
    default:
        defined('WP_DEBUG') or define('WP_DEBUG', false);
        defined('WP_DEBUG_DISPLAY') or define('WP_DEBUG_DISPLAY', false);
        defined('WP_DEBUG_LOG') or define('WP_DEBUG_LOG', false);
        defined('SAVEQUERIES') or define('SAVEQUERIES', false);
        defined('SCRIPT_DEBUG') or define('SCRIPT_DEBUG', false);
        break;
}
```

For backward compatibility reason instead of `WP_ENV` it is possible to use `WORDPRESS_ENV` with same result.

But there's more. If a PHP file named like `{$environment}.php` (where `$environment` is the value of `WP_ENV` env var) exists in project root file that file will be loaded in the related environment.

This allow for more advanced per-environment settings, e.g. force the enabled status of plugins based on environments and so on.

To make such advanced configuration the PHP file needs to add WordPress hooks, and that *normally* would be not doable from` wp-config.php`, but WP Starter allows that.

### WP_ADMIN_COLOR

`WP_ADMIN_COLOR` environment variable will make WP Starter add a filter in the generated `wp-config.php` that will force WordPress dashboard to a specific admin color scheme, overriding the user setting.

For example:

```shell
WP_ADMIN_COLOR=ectoplasm
```

will force the current environment to use the "ectoplasm" color scheme.

Supported schemes are the ones shipped core ("light", "blue", "coffee", "ectoplasm", "midnight", "ocean", "sunrise") plus any additional color scheme that plugins might have added to WordPress.

Changing admin color per environment helps to recognize visually which is the current environment and avoid, for example, doing in production operations meant for staging.



## Early loading of `plugin.php`

The file `wp-includes/plugin.php` contains WordPress function for [plugin API](https://developer.wordpress.org/plugins/hooks/).

In recent WordPress versions this file has been made "independent" from the rest of WordPress, which means tha tit can be loaded very early allowing to add hooks very early, before the rest of WordPress is loaded.

In the `wp-config.php` WP Starter generates the file is loaded early, so that it is possible to add hooks, for example, in the  `{$environment}.php` (see above) or in a dedicated "early hooks file".



## Early hook file

In WP Starter configuration it is possible to set an "early hooks file" loaded very early (right after   `{$environment}.php`) that can be used to add callbacks to hooks triggered very early, like for example [`"enable_loading_advanced_cache_dropin"`](https://developer.wordpress.org/reference/hooks/enable_loading_advanced_cache_dropin/) or to set just-in-time WordPress configuration PHP constants.



## SSL behind load-balancers

When websites are behind load-balancers the server variable `$_SERVER['HTTPS']` is sometimes not set, even if the website is implementing HTTPS, and because WordPress function [`is_ssl()`](https://developer.wordpress.org/reference/functions/is_ssl/) relies on that server variable it returns `false` in that case, with many side effects.

As quite standard practice, in those cases load balancers set the server variable `$_SERVER['HTTP_X_FORWARDED_PROTO']` to `'https'` . So by looking at that `$_SERVER['HTTPS']` could be forced to `'on'` to make `is_ssl()` correctly return `true`. WP Starter can do that, and to enable this feature it is necessary to set the environment variable **`WP_FORCE_SSL_FORWARDED_PROTO`** to true.

There might be security implications in this, please see the "Make WordPress" ticket [#31288](https://core.trac.wordpress.org/ticket/31288) for details.

The gist of it is that `HTTP_X_FORWARDED_PROTO` is a server variable set from HTTP header (like any `$_SERVER` variable prepended with `HTTP_`) which means that it could be set by the client or by a [MITM](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) proxy. On the other hand, environment variable can only be set on the server, so checking the env variable makes the HTTP header trustable.